<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>我們的婚紗相簿｜Wedding Album</title>
  <meta name="robots" content="noindex" />
  <style>
    :root{
      --pink1:#F8E6EE; --pink2:#FFF9FB; --gray:#A4A2A0; --ink:#2b2b2b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
      background:linear-gradient(160deg,var(--pink1),var(--pink2));
      color:var(--ink);
    }
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter:saturate(180%) blur(10px);
      background:color-mix(in oklab, white 60%, transparent);
      border-bottom:1px solid rgba(255,255,255,.6);
    }
    .container{max-width:1100px; margin:0 auto; padding:20px}
    h1{margin:0; font-weight:700; letter-spacing:.02em}
    .sub{margin:.35rem 0 0; color:#666}

    /* 控制網格：漂亮又簡單 */
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:14px; padding:24px 20px 64px}
    figure{margin:0; border-radius:16px; overflow:hidden; background:rgba(255,255,255,.6); border:1px solid rgba(255,255,255,.8); box-shadow:0 10px 24px rgba(0,0,0,.06)}
    figure a{display:block; text-decoration:none; color:inherit}
    img{display:block; width:100%; height:100%; object-fit:cover; background:#f2f2f2}
    .ph{aspect-ratio: 4/3; display:grid; place-items:center; color:#999; font-size:.9rem}
    figcaption{padding:10px 12px; font-size:.92rem; color:#555}

    /* 浮動 lightbox */
    dialog#lightbox{border:none; padding:0; border-radius:18px; max-width:min(92vw,1200px); width:fit-content; overflow:clip; box-shadow:0 30px 80px rgba(0,0,0,.35)}
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .lb-wrap{position:relative; background:#000}
    .lb-img{display:block; max-width:calc(min(92vw,1200px)); max-height:85vh; width:auto; height:auto; object-fit:contain; background:#000}
    .lb-ui{position:absolute; inset:0; display:flex; align-items:center; justify-content:space-between; pointer-events:none}
    .lb-btn{pointer-events:auto; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.45); color:#fff; width:44px; height:44px; display:grid; place-items:center; border-radius:50%; margin:0 8px; cursor:pointer}
    .lb-close{position:absolute; top:8px; right:8px}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

    footer{padding:24px 0 60px; text-align:center; color:#777}
    .muted{color:#888}
    .brand{color:var(--gray)}

    .hidden{display:none !important}
    .error{color:#b00020; background:#fff; border-left:4px solid #b00020; padding:12px 14px; border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>陳郁芳與鄭宇翔的婚紗相簿</h1>
      <p class="sub">相簿會自動讀取 <code>WeddingPhoto/</code> 內的圖片並美觀排列。點擊可全螢幕瀏覽。</p>
    </div>
  </header>

  <main class="container">
    <div id="notice" class="muted">載入中…</div>
    <div id="error" class="error hidden"></div>
    <section id="grid" class="grid" aria-live="polite"></section>
  </main>

  <footer>
    <small class="muted">Made with ❤︎ <span class="brand">#F8E6EE → #FFF9FB · #A4A2A0</span></small>
  </footer>

  <dialog id="lightbox" aria-label="照片檢視">
    <div class="lb-wrap">
      <img id="lb-img" class="lb-img" alt="" />
      <button class="lb-btn lb-close" id="lb-close" aria-label="關閉">✕</button>
      <div class="lb-ui">
        <button class="lb-btn" id="lb-prev" aria-label="上一張">‹</button>
        <span class="sr-only" id="lb-count"></span>
        <button class="lb-btn" id="lb-next" aria-label="下一張">›</button>
      </div>
    </div>
  </dialog>

  <script>
  // === 可自訂：把下面四個常數改成你的 GitHub 設定 ===
  const GH_USER   = "ZYXCFF";      // 例如： zhengyx
  const GH_REPO   = "WeddingAlbum";     // 例如： username.github.io 或 weddingalbum
  const GH_BRANCH = "main";           // 例如 main 或 gh-pages
  const FOLDER    = "WeddingPhoto";   // 你的相片資料夾

  // 若此頁在 GitHub Pages 網域上，可嘗試自動抓取 USER/REPO
  try{
    const host = location.hostname; // e.g. username.github.io
    const pathParts = location.pathname.replace(/^\//,'').split('/');
    // 若是 user/organization page（repo 名稱等於 username.github.io），就只用 host；
    // 若是 project page（/repo/…），補上 repo 名稱
    if(host.includes('.github.io')){
      const username = host.split('.github.io')[0];
      if(GH_USER === "USERNAME") window.GH_USER_AUTO = username;
      if(GH_REPO === "REPOSITORY"){
        // project page: /repo/… ; user page: /
        const maybeRepo = pathParts[0] || `${username}.github.io`;
        window.GH_REPO_AUTO = maybeRepo;
      }
    }
  }catch(e){}

  const user   = window.GH_USER_AUTO || GH_USER;
  const repo   = window.GH_REPO_AUTO || GH_REPO;
  const branch = GH_BRANCH;

  const API = `https://api.github.com/repos/${user}/${repo}/contents/${encodeURIComponent(FOLDER)}?ref=${encodeURIComponent(branch)}`;

  const grid   = document.getElementById('grid');
  const notice = document.getElementById('notice');
  const errBox = document.getElementById('error');

  const ALLOWED = new Set(['.jpg','.jpeg','.png','.webp','.gif','.avif']);
  const photos = [];

  function fileExt(name){
    const i = name.lastIndexOf('.');
    return i>=0 ? name.slice(i).toLowerCase() : '';
  }

  function niceCaption(name){
    return name.replace(/^(.+)(\.[^.]+)$/,'$1')
               .replace(/[_-]+/g,' ')
               .replace(/\s+/g,' ')
               .trim();
  }

  function makeCard({url,name}){
    const fig = document.createElement('figure');
    const a = document.createElement('a'); a.href = url; a.setAttribute('data-name', name);
    const ph = document.createElement('div'); ph.className='ph'; ph.textContent='載入中…';
    const img = document.createElement('img'); img.loading='lazy'; img.alt = niceCaption(name);
    img.addEventListener('load',()=>{ ph.replaceWith(img); });
    img.addEventListener('error',()=>{ ph.textContent='載入失敗'; });
    img.src = url;
    a.appendChild(ph);
    a.addEventListener('click', ev => {
      ev.preventDefault();
      openLightbox(url);
    });

    const cap = document.createElement('figcaption');
    cap.textContent = niceCaption(name);

    fig.appendChild(a);
    fig.appendChild(cap);
    return fig;
  }

  // Lightbox
  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lb-img');
  const lbPrev = document.getElementById('lb-prev');
  const lbNext = document.getElementById('lb-next');
  const lbClose = document.getElementById('lb-close');
  let idx = -1;

  function openLightbox(url){
    idx = photos.findIndex(p => p.url === url);
    if(idx<0) idx = 0;
    updateLB();
    if(!lb.open) lb.showModal();
  }
  function updateLB(){
    const p = photos[idx];
    lbImg.src = p.url; lbImg.alt = p.name;
  }
  function step(d){
    if(!photos.length) return;
    idx = (idx + d + photos.length) % photos.length;
    updateLB();
  }
  lbPrev.addEventListener('click', ()=> step(-1));
  lbNext.addEventListener('click', ()=> step(+1));
  lbClose.addEventListener('click', ()=> lb.close());
  lb.addEventListener('click', (e)=>{ if(e.target === lb) lb.close(); });
  window.addEventListener('keydown', (e)=>{
    if(!lb.open) return;
    if(e.key==='ArrowLeft') step(-1);
    else if(e.key==='ArrowRight') step(+1);
    else if(e.key==='Escape') lb.close();
  });

  async function load(){
    try{
      const r = await fetch(API, {headers:{'Accept':'application/vnd.github+json'}});
      if(!r.ok){
        const t = await r.text();
        throw new Error(`GitHub API ${r.status}: ${t}`);
      }
      const list = await r.json();
      const files = list.filter(it => it.type === 'file' && ALLOWED.has(fileExt(it.name)));
      if(!files.length){
        notice.textContent = '資料夾目前沒有任何圖片；請將 .jpg/.png/.webp 檔案放到 WeddingPhoto/ 後重新整理。';
        return;
      }
      notice.classList.add('hidden');
      files.sort((a,b)=> a.name.localeCompare(b.name, undefined, {numeric:true, sensitivity:'base'}));
      for(const f of files){
        const url = f.download_url; // 原始檔案 URL（含必要編碼）
        photos.push({url, name:f.name});
        grid.appendChild(makeCard({url, name:f.name}));
      }
    }catch(err){
      console.error(err);
      notice.classList.add('hidden');
      errBox.classList.remove('hidden');
      errBox.textContent = '讀取相片清單失敗：' + (err.message || err);
    }
  }
  load();
  </script>
</body>
</html>
